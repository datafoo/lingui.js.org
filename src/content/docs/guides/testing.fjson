{"parents": [], "prev": {"link": "../../tutorials/cli/", "title": "Working with LinguiJS CLI"}, "next": {"link": "../typescript/", "title": "Typescript"}, "title": "Testing", "meta": {}, "body": "<div class=\"section\" id=\"testing\">\n<h1>Testing<a class=\"headerlink\" href=\"#testing\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<div class=\"admonition warning\">\n<p class=\"first admonition-title\">Warning</p>\n<p class=\"last\">This is an incomplete draft of a guide.</p>\n</div>\n<p>Components using <a class=\"reference internal\" href=\"../../ref/react/#component-Trans\">&lt;Trans&gt;</a> or <a class=\"reference internal\" href=\"../../ref/react/#withI18n\" title=\"withI18n\"><code class=\"xref js js-func docutils literal notranslate\"><span class=\"pre\">withI18n()</span></code></a> must be wrapped in\n<a class=\"reference internal\" href=\"../../ref/react/#component-I18nProvider\">&lt;I18nProvider&gt;</a> in tests:</p>\n<div class=\"highlight-jsx notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kr\">import</span> <span class=\"nx\">React</span> <span class=\"nx\">from</span> <span class=\"s1\">&#39;react&#39;</span>\n<span class=\"kr\">import</span> <span class=\"p\">{</span> <span class=\"nx\">mount</span> <span class=\"p\">}</span> <span class=\"nx\">from</span> <span class=\"s1\">&#39;enzyme&#39;</span>\n<span class=\"kr\">import</span> <span class=\"p\">{</span> <span class=\"nx\">I18nProvider</span> <span class=\"p\">}</span> <span class=\"nx\">from</span> <span class=\"s1\">&#39;@lingui/react&#39;</span>\n<span class=\"kr\">import</span> <span class=\"nx\">Component</span> <span class=\"nx\">from</span> <span class=\"s1\">&#39;./Component&#39;</span>\n\n<span class=\"nx\">describe</span><span class=\"p\">(</span><span class=\"s1\">&#39;Component&#39;</span><span class=\"p\">,</span> <span class=\"kd\">function</span> <span class=\"p\">()</span> <span class=\"p\">{</span>\n  <span class=\"nx\">it</span><span class=\"p\">(</span><span class=\"s1\">&#39;should render correctly&#39;</span><span class=\"p\">,</span> <span class=\"kd\">function</span> <span class=\"p\">()</span> <span class=\"p\">{</span>\n     <span class=\"kr\">const</span> <span class=\"nx\">tree</span> <span class=\"o\">=</span> <span class=\"nx\">mount</span><span class=\"p\">(&lt;</span><span class=\"nt\">I18nProvider</span><span class=\"p\">&gt;&lt;</span><span class=\"nt\">Component</span> <span class=\"p\">/&gt;&lt;/</span><span class=\"nt\">I18nProvider</span><span class=\"p\">&gt;</span>\n     <span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">tree</span><span class=\"p\">).</span><span class=\"nx\">toMatchSnapshot</span><span class=\"p\">()</span>\n  <span class=\"p\">})</span>\n<span class=\"p\">})</span>\n</pre></div>\n</div>\n<div class=\"section\" id=\"snapshot-testing\">\n<h2>Snapshot testing<a class=\"headerlink\" href=\"#snapshot-testing\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p><a class=\"reference external\" href=\"https://jestjs.io/docs/en/snapshot-testing\">Snapshot testing</a> is fast and convenient way to ensure you app doesn\u2019t change\nunexpectedly. However, components are serialized with all props, so even simple\ntranslation:</p>\n<div class=\"highlight-jsx notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"p\">&lt;</span><span class=\"nt\">Trans</span><span class=\"p\">&gt;</span><span class=\"nx\">Today</span> <span class=\"nx\">is</span> <span class=\"p\">&lt;</span><span class=\"nt\">DateFormat</span> <span class=\"na\">value</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"nx\">now</span><span class=\"p\">}</span> <span class=\"p\">/&gt;&lt;/</span><span class=\"nt\">Trans</span><span class=\"p\">&gt;</span>\n</pre></div>\n</div>\n<p>has a very long and hard to read snapshot:</p>\n<div class=\"highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>&lt;Trans\n i18n={\n   I18n {\n     _activeLanguageData: Object {\n       plurals: [Function],\n     },\n     _activeMessages: Object {},\n     _catalogs: Object {\n       en: Object {\n         languageData: Object {},\n         messages: Object {},\n       },\n     },\n     _dev: Object {\n       compile: [Function],\n       loadLanguageData: [Function],\n     },\n     _language: en,\n     _locales: undefined,\n     plural: [Function],\n     select: [Function],\n     selectOrdinal: [Function],\n     t: [Function],\n   }\n }\n i18nHash={null}\n id=Today is {now,date}\n values={\n   Object {\n     now: 2017-04-05T11:14:00.000Z,\n   }\n }\n&gt;\n &lt;Render\n   value=Today is 4/5/2017\n &gt;\n   Today is 4/5/2017\n &lt;/Render&gt;\n&lt;/Trans&gt;\n</pre></div>\n</div>\n<p>In such case we might want to test just an HTML output. <a class=\"reference external\" href=\"https://github.com/rayrutjes/jest-serializer-html\">jest-serializer-html</a>\nindents and formats HTML in snapshot making it easier to diff. Add it to Jest config:</p>\n<div class=\"highlight-json notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"p\">{</span>\n   <span class=\"nt\">&quot;snapshotSerializers&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n      <span class=\"s2\">&quot;jest-serializer-html&quot;</span>\n   <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</pre></div>\n</div>\n<p>Instead of serializing element wrapper, serialize HTMl instead:</p>\n<div class=\"highlight-jsx notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">mount</span><span class=\"p\">(&lt;</span><span class=\"nt\">Trans</span><span class=\"p\">&gt;</span><span class=\"nx\">Today</span> <span class=\"nx\">is</span> <span class=\"p\">&lt;</span><span class=\"nt\">DateFormat</span> <span class=\"na\">value</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"nx\">now</span><span class=\"p\">}</span> <span class=\"p\">/&gt;&lt;/</span><span class=\"nt\">Trans</span><span class=\"p\">&gt;).</span><span class=\"nx\">html</span><span class=\"p\">())</span>\n   <span class=\"p\">.</span><span class=\"nx\">toMatchSnapshot</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>The final snapshot is shorter and easy to review:</p>\n<div class=\"highlight-html notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"p\">&lt;</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>Today is 4/5/2017<span class=\"p\">&lt;/</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>\n</pre></div>\n</div>\n</div>\n</div>\n", "metatags": "", "rellinks": [["genindex", "General Index", "I", "index"], ["guides/typescript", "Typescript", "N", "next"], ["tutorials/cli", "Working with LinguiJS CLI", "P", "previous"]], "sourcename": "guides/testing.rst.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Testing</a><ul>\n<li><a class=\"reference internal\" href=\"#snapshot-testing\">Snapshot testing</a></li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".rst", "current_page_name": "guides/testing", "sidebars": ["about.html", "navigation.html", "relations.html", "searchbox.html", "donate.html"], "customsidebar": null, "alabaster_version": "0.7.11", "display_github": true, "github_user": "lingui", "github_version": "master/", "github_repo": "js-lingui", "conf_py_path": "docs/"}